name: Molecule
on: [ push ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python 3.
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'

    - name: Install test dependencies.
      run: pip3 install molecule docker yamllint ansible-lint


    - name: setup current project as ansible role
      run: |
        mkdir -p ~/.ansible/roles
        ln -s . ~/.ansible/roles/geerlingguy.php-versions

    - name: Run Molecule tests.
      run: molecule test
      env:
        PY_COLORS: '1'
        ANSIBLE_FORCE_COLOR: '1'
